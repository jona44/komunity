{% load crispy_forms_tags %}
<form method="post" 
      action="{% url 'create_contribution' %}" 
      hx-post="{% url 'create_contribution' %}"
      hx-target="#contribution_form_container"
      class="space-y-4">
    {% csrf_token %}
    
    {% if form.non_field_errors %}
    <div class="alert alert-error text-sm py-2">
        {{ form.non_field_errors }}
    </div>
    {% endif %}

    <!-- Contributing Member -->
    <div class="form-control">
        <label class="label">
            <span class="label-text font-medium text-gray-700">Contributor</span>
        </label>
        {{ form.contributing_member }}
        {% if form.contributing_member.errors %}
        <span class="text-error text-xs mt-1">{{ form.contributing_member.errors.0 }}</span>
        {% endif %}
    </div>

    <!-- Deceased Member -->
    <div class="form-control">
        <label class="label">
            <span class="label-text font-medium text-gray-700">For Deceased</span>
        </label>
        {% if form.deceased_member.field.widget.input_type == 'hidden' %}
            <div class="px-3 py-2 bg-gray-100 rounded-lg text-gray-700 font-medium border border-gray-200">
                Are you contributing for: <span class="text-blue-600">{{ deceased_name|default:"Selected Member" }}</span>?
            </div>
             <!-- We need to render the hidden field so the value is submitted -->
            {{ form.deceased_member }}
        {% else %}
            {{ form.deceased_member }}
        {% endif %}

        {% if form.deceased_member.errors %}
        <span class="text-error text-xs mt-1">{{ form.deceased_member.errors.0 }}</span>
        {% endif %}
    </div>

    <!-- Amount -->
    <div class="form-control">
        <label class="label">
            <span class="label-text font-medium text-gray-700">Amount</span>
        </label>
        <div class="relative">
            <span class="absolute inset-y-0 left-0 pl-3 flex items-center text-gray-500">
                R
            </span>
            {{ form.amount }}
        </div>
        {% if form.amount.errors %}
        <span class="text-error text-xs mt-1">{{ form.amount.errors.0 }}</span>
        {% endif %}
    </div>

    <div class="modal-action mt-6">
        <button type="submit" class="btn btn-primary bg-gradient-to-r from-blue-500 to-purple-600 border-none w-full text-white normal-case text-base">
            Record Contribution
        </button>
    </div>
</form>
