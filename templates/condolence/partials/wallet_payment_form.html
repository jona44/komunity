<div class="space-y-6">
    <div class="text-center mb-6">
        <h3 class="text-xl font-bold text-gray-900">Pay Contribution</h3>
        <p class="text-sm text-gray-500">for {{ deceased_name }}</p>
    </div>

    <!-- Wallet Balance Section -->
    <div class="bg-gray-900 rounded-2xl p-6 text-white relative overflow-hidden group">
        <div class="absolute top-0 right-0 w-32 h-32 bg-white/5 rounded-full -mr-16 -mt-16 transition-transform group-hover:scale-110"></div>
        <div class="relative z-10 flex flex-col items-center justify-center space-y-2">
            <span class="text-gray-400 text-xs font-bold uppercase tracking-widest">My Wallet Balance</span>
            <div class="text-4xl font-black tracking-tight" 
                 hx-get="{% url 'wallet_balance' %}" 
                 hx-trigger="load, update-balance from:body"
                 hx-swap="innerHTML">
                Loading...
            </div>
        </div>
    </div>

    <!-- Payment Actions Tab -->
    <div class="tabs tabs-boxed bg-gray-100 p-1 rounded-xl grid grid-cols-2 gap-1" x-data="{ tab: 'pay' }">
        <a class="tab rounded-lg font-bold text-sm transition-all duration-200" 
           :class="tab === 'pay' ? 'bg-white shadow-sm text-blue-600' : 'text-gray-500 hover:bg-gray-200'"
           @click.prevent="tab = 'pay'">Pay Contribution</a>
        <a class="tab rounded-lg font-bold text-sm transition-all duration-200" 
           :class="tab === 'topup' ? 'bg-white shadow-sm text-green-600' : 'text-gray-500 hover:bg-gray-200'"
           @click.prevent="tab = 'topup'">Top Up Wallet</a>

        <!-- Pay Panel -->
        <div x-show="tab === 'pay'" class="col-span-2 mt-4 bg-white rounded-xl p-4 border border-gray-100 shadow-sm text-left">
            <form hx-post="{% url 'wallet_transfer_group' active_group.id %}" 
                  hx-target="#contribution_form_container" 
                  class="space-y-4">
                {% csrf_token %}
                <input type="hidden" name="deceased_id" value="{{ deceased_id }}">
                
                <div class="form-control">
                    <label class="label"><span class="label-text font-bold text-gray-700">Amount</span></label>
                    <div class="relative">
                        <span class="absolute inset-y-0 left-0 pl-3 flex items-center text-gray-500 font-bold">R</span>
                        <input type="number" step="0.01" name="amount" placeholder="100.00" class="input input-bordered w-full pl-8 font-bold text-lg focus:border-blue-500 focus:ring-1 focus:ring-blue-500" required>
                    </div>
                </div>

                <button type="submit" class="btn btn-primary w-full bg-blue-600 hover:bg-blue-700 border-none text-white font-bold rounded-xl shadow-lg shadow-blue-200">
                    Pay Now (Mobile Money)
                </button>
            </form>
        </div>

        <!-- Top Up Panel -->
        <div x-show="tab === 'topup'" style="display: none;" class="col-span-2 mt-4 bg-white rounded-xl p-4 border border-gray-100 shadow-sm text-left">
            <form hx-post="{% url 'wallet_top_up' %}" 
                  hx-target="#topup-message" 
                  class="space-y-4">
                {% csrf_token %}
                
                <div class="form-control">
                    <label class="label"><span class="label-text font-bold text-gray-700">Voucher PIN</span></label>
                    <input type="text" name="voucher_pin" placeholder="Enter PIN from voucher" class="input input-bordered w-full font-mono text-center tracking-widest text-lg" required>
                </div>
                
                <div id="topup-message" class="text-center min-h-[20px]"></div>

                <button type="submit" class="btn btn-success w-full bg-green-500 hover:bg-green-600 border-none text-white font-bold rounded-xl shadow-lg shadow-green-200">
                    Redeem Voucher
                </button>
            </form>
        </div>
    </div>
</div>

<!-- Alpine.js interaction to handle success close triggers if needed, 
     though HTMX trigger 'close-transfer-modal' logic needs a listener elsewhere or can be handled here -->
<script>
    document.body.addEventListener('close-transfer-modal', function(){
        // Assuming the modal is 'create_contribution_modal'
        create_contribution_modal.close();
    });
</script>
