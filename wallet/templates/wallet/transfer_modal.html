<dialog id="transfer_modal" class="modal">
  <div class="modal-box bg-white">
    <form method="dialog">
      <button class="btn btn-sm btn-circle btn-ghost absolute right-2 top-2">âœ•</button>
    </form>
    <h3 class="font-bold text-lg mb-4">Transfer to {{ group.name }}</h3>
    <p class="py-2 text-sm text-gray-500 mb-4">Move funds from your wallet to this group.</p>
    
    {% if group %}
    <form hx-post="{% url 'wallet_transfer_group' group.id %}" hx-swap="afterend" class="space-y-4">
    {% else %}
    <div class="p-4 text-center text-red-500">Error: No group context found.</div>
    {% endif %}
        {% csrf_token %}
        
        {% if active_deceased.count > 1 %}
        <div>
            <label for="deceased_id" class="block text-sm font-medium text-gray-700 mb-2">Campaign</label>
            <select name="deceased_id" id="deceased_id" required
                    class="select select-bordered w-full bg-white focus:border-blue-500 focus:ring-1 focus:ring-blue-500">
                <option value="">Select a campaign...</option>
                {% for deceased in active_deceased %}
                <option value="{{ deceased.id }}">{{ deceased.deceased.full_name }} - {{ deceased.date|date:"M d, Y" }}</option>
                {% endfor %}
            </select>
        </div>
        {% else %}
        <!-- If only one active deceased, pass it as hidden -->
        <input type="hidden" name="deceased_id" value="{{ active_deceased.first.id }}">
        <div class="bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4">
            <p class="text-sm text-blue-800">
                <span class="font-semibold">Campaign:</span> {{ active_deceased.first.deceased.full_name }}
            </p>
        </div>
        {% endif %}
        
        <div>
            <label for="amount" class="block text-sm font-medium text-gray-700">Amount (R)</label>
            <div class="mt-1 relative rounded-md shadow-sm">
                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                  <span class="text-gray-500 sm:text-sm">R</span>
                </div>
                <input type="number" name="amount" id="amount" step="0.01" min="0" required 
                       class="focus:ring-blue-500 focus:border-blue-500 block w-full pl-7 pr-12 sm:text-sm border-gray-300 rounded-md" 
                       placeholder="0.00">
            </div>
        </div>
        <button type="submit" class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
            Transfer Funds
        </button>
    </form>
  </div>
</dialog>
<script>
    document.body.addEventListener('close-transfer-modal', function(){
        document.getElementById('transfer_modal').close();
    });
</script>
